<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Entrance Counter</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <!-- <script type="text/javascript" src="https://www.google.com/jsapi"></script> -->
</head>

<body>

  <script>
    var chartData = null;
    var chart = null;
    var socket = io();
    google.charts.load('current', { 'packages': ['gauge'] });
    google.charts.setOnLoadCallback(function () {
      $(function () {
        chart = new google.visualization.Gauge(document.getElementById("chart_div"));

        chartData = [
          ['Label', 'Value'],
          ['Users online', 0],
          ['Door one', 0],
          ['Door two', 0]
        ];


        socket.on('onlineUserCount', function (msg) {
          $('#onlineCounter').html(msg);
          chartData[1] = ['Users online', msg];
          drawChart();
        });

        socket.on('doorOne', function (msg) {
          $('#doorOne').html(msg);
          chartData[2] = ['Door one', msg];
          drawChart();
        });

        socket.on('doorTwo', function (msg) {
          $('#doorTwo').html(msg);
          chartData[3] = ['Door two', msg];
          drawChart();
        });
      });
    });

    function drawChart() {

      var data = google.visualization.arrayToDataTable(chartData);

      var options = {
        width: 1000, height: 400,
        redFrom: 8, redTo: 10,
        yellowFrom: 6, yellowTo: 8,
        greenFrom: 1, greenTo: 3,
        minorTicks: 5,
        max: 10,
      };

      chart.draw(data, options);

    }
      //todo - use post
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(function () {
      $(function () {
        var dustChart = new google.visualization.LineChart(document.getElementById('dustinessOfTheAirChart'));
        var dustData = new google.visualization.DataTable();

        var options = {
          width: 900,
          height: 500,
          animation: {
            startup: true,
            duration: 1000,
            easing: 'in'
          }
        };

        dustData.addColumn("timeofday", "Hour");
        dustData.addColumn("number", "Dust Particles");

        $.get("/getAllDustParticles")
          .fail(() => alert("Could not load data from the server"))
          .always((d) => {
            dustData.addRows(d);
            dustChart.draw(dustData, options);
          });

        socket.on("onDustParticlesSensor", function (airDustinessAndtimeData) {
          dustData.addRow(airDustinessAndtimeData);
          dustChart.draw(dustData, options);
        });

        socket.on("onDataUpdated", function (airDustinessAndtimeData) {
          dustData.removeRows(0, dustData.getNumberOfRows());
          dustData.addRows(airDustinessAndtimeData);
          dustChart.draw(dustData, options);
        });


      })
    })
  </script>

  <div id="dustinessOfTheAirChart"></div>
  <h1>Online Users</h1>
  <h1 id="onlineCounter">0</h1>
  <h1>Door One</h1>
  <h1 id="doorOne">0</h1>
  <h1>Door Two</h1>
  <h1 id="doorTwo">0</h1>
  <div id="chart_div" style="width: 900px; height: 500px;"></div>
</body>

</html>